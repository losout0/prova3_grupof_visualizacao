<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab8 - Grupo [LETRA]</title>

    <style>
      body {
        font-family: "Roboto", sans-serif;
        background-color: #f4f6f9;
        color: #333;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .dashboard-header {
        background-color: #2c3e50;
        color: white;
        padding: 30px;
        text-align: left;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .dashboard-title {
        margin: 0;
        font-size: 36px;
        font-weight: 700;
      }
      .lead {
        font-size: 20px;
        color: #ecf0f1;
        margin-top: 10px;
      }
      .controls {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        align-items: center;
        justify-content: center;
      }
      .control-group {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .controls label {
        font-weight: bold;
      }
      .controls select {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 1em;
      }
      #chart-header {
        display: flex;
        align-items: left;
        justify-content: space-between;
        width: 100%;
        max-width: 800px;
      }
      #chart-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 40px;
      }
      #chart {
        width: 100%;
        max-width: 800px;
        height: 500px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-top: 30px;
      }
      #back-button {
        display: none;
        margin-top: 20px;
        padding: 12px;
        font-size: 16px;
        background-color: #3498db;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s ease;
      }
      #back-button:hover {
        background-color: #2980b9;
      }
      .card {
        margin: 40px auto;
        border: none;
        overflow: hidden;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .card-header {
        background-color: #34495e;
        color: white;
        padding: 20px;
        font-size: 18px;
        font-weight: 600;
      }
      .card-body {
        padding: 30px;
        font-size: 16px;
        color: #7f8c8d;
        line-height: 1.6;
      }
      .header-info {
        padding: 20px 50px;
        background-color: #a4dceb;
      }
    </style>
  </head>
  <body>
    <div class="header-info">
      <table style="width: 100%; border: 0">
        <tbody>
          <tr>
            <td style="text-align: left; vertical-align: top">
              <table style="border: 0">
                <tbody>
                  <tr>
                    <td style="width: 70px">
                      <img
                        src="https://maxmcz.github.io/visualizacao-de-dados_exemplo/UFCG_logo_png.png"
                        alt="Brasão UFCG"
                        style="margin-top: 5px; height: 62px"
                      />
                    </td>
                    <td>
                      <div style="line-height: 1.4">
                        <div>
                          <strong
                            >UNIVERSIDADE FEDERAL DE CAMPINA GRANDE -
                            UFCG</strong
                          >
                        </div>
                        <div>
                          CENTRO DE ENGENHARIA ELÉTRICA E INFORMÁTICA - CEEI
                        </div>
                        <div>
                          UNIDADE ACADÊMICA DE SISTEMAS E COMPUTAÇÃO - UASC
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </td>

            <td style="text-align: right; vertical-align: top">
              <div>Disciplina: Visualização de Dados</div>
              <div>Professor: Maxwell Guimarães de Oliveira</div>
              <div>Período: 2025.1</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div id="header">
      <h2 style="text-align: center">
        Projeto de Visualização Interativa de Dados
      </h2>
      <h4 style="text-align: center">
        <u>Grupo F</u>: Felipe Gangorra, Gabriel Carvalho, Leandro Souto, Sara
        Siqueira, Wanderson Souto&nbsp; &nbsp;
      </h4>
      <h2 style="text-align: center">
        <span
          style="
            font-family: &#39;Lucida Sans Unicode&#39;, &#39;Lucida Grande&#39;, sans-serif;
          "
          ><strong>A Jornada da LEGO Através dos Anos</strong></span
        >
      </h2>
      <p style="text-align: justify; padding: 10px 50px 10px 50px">
        Breve resumo sobre os dados (e as histórias) visualizadas.
      </p>
    </div>

    <div class="controls">
      <div class="control-group">
        <label for="theme-filter">Filtrar por Tema:</label>
        <select id="theme-filter"></select>
      </div>
      <div class="control-group">
        <label for="category-filter">Filtrar por Categoria:</label>
        <select id="category-filter"></select>
      </div>
    </div>

    <div
      id="container"
      style="max-width: 100%; height: 470px; padding: 10px 50px 10px 50px"
    ></div>

    <div id="footer" style="height: 2%; margin-top: 150px">
      <p style="text-align: justify; padding: 20px 50px 0px 50px">
        <b>Dicas para interagir com a visualização</b>:
      </p>
      <ul style="padding: 0px 50px 10px 75px">
        <li>
          Inserir aqui breves instruções para o usuário navegar na visualização
          e usar o máximo dos recursos de interação disponíveis.
        </li>
        <li>...</li>
        <li>...</li>
      </ul>
    </div>

    <script
      type="text/javascript"
      src="https://fastly.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://fastly.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"
    ></script>

    <!-- Uncomment this line if you want to dataTool extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.5.0/dist/extension/dataTool.min.js"></script>
  -->
    <!-- Uncomment this line if you want to use gl extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
  -->
    <!-- Uncomment this line if you want to echarts-stat extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts-stat@latest/dist/ecStat.min.js"></script>
  -->
    <!-- Uncomment this line if you want to use map
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/china.js"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script>
  -->
    <!-- Uncomment these two lines if you want to use bmap extension
  <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_API_KEY"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.5.0/dist/extension/bmap.min.js"></script>
  -->

    <script type="text/javascript">
      const data_from_csv = "lego_sets_clean.csv";
      const themeFilter = document.getElementById("theme-filter");
      const categoryFilter = document.getElementById("category-filter");
      const chart_dom = document.getElementById("container");

      let raw_data = [];

      var myChart = echarts.init(chart_dom, null, {
        renderer: "canvas",
        useDirtyRect: false,
      });
      var app = {};
      var option;

      myChart.showLoading();

      function findFieldName(obj, candidates) {
        if (!obj || typeof obj !== "object") return undefined;
        const keys = Object.keys(obj);
        const low = keys.reduce((acc, k) => {
          acc[k.toLowerCase()] = k;
          return acc;
        }, {});
        for (let cand of candidates)
          if (low[cand.toLowerCase()]) return low[cand.toLowerCase()];
        return undefined;
      }

      function parseCSV(csvText) {
        const lines = csvText.trim().split("\n");
        if (lines.length < 2) return [];

        const headers = lines[0].split(";").map((h) => h.trim());

        return lines.slice(1).map((line) => {
          const values = line.split(";");
          const entry = {};
          headers.forEach((header, i) => {
            entry[header] = values[i] ? values[i].trim() : "";
          });
          return entry;
        });
      }

      $.get(data_from_csv).done(function (csv_string) {
        raw_data = parseCSV(csv_string);
        myChart.hideLoading();

        if (!raw_data || raw_data.length === 0) {
          alert("O arquivo csv está vazio ou em um formato inválido.");
          return;
        }

        const yearField = findFieldName(raw_data[0], ["year"]) || "year";
        const piecesField = findFieldName(raw_data[0], ["pieces"]) || "pieces";
        const themeField = findFieldName(raw_data[0], ["theme"]) || "theme";
        const categoryField =
          findFieldName(raw_data[0], ["category"]) || "category";
        const nameField = findFieldName(raw_data[0], ["name"]) || "name";

        const themes = new Set(raw_data.map((set) => set[themeField]))
        
        function populateThemeFilter() {
          const themes = [
            ...new Set(raw_data.map((set) => set[themeField])),
          ].sort();
          themeFilter.innerHTML = '<option value="All">Todos os Temas</option>';
          themes.forEach((theme) => {
            if (theme) {
              const option = document.createElement("option");
              option.value = theme;
              option.textContent = theme;
              themeFilter.appendChild(option);
            }
          });
        }

        function populateCategoryFilter() {
          const categories = [
            ...new Set(raw_data.map((set) => set[categoryField])),
          ].sort();
          categoryFilter.innerHTML =
            '<option value="All">Todas as Categorias</option>';
          categories.forEach((category) => {
            if (category) {
              const option = document.createElement("option");
              option.value = category;
              option.textContent = category;
              categoryFilter.appendChild(option);
            }
          });
        }
        populateThemeFilter();
        populateCategoryFilter();
      });

      myChart.hideLoading();
      myChart.setOption(
        (option = {
          title: {
            text: "",
          },
          tooltip: {
            trigger: "item",
            triggerOn: "mousemove",
          },
          series: [
            {
              type: "sankey",
              data: data.nodes,
              links: data.links,
              emphasis: {
                focus: "adjacency",
              },
              lineStyle: {
                color: "gradient",
                curveness: 0.5,
              },
            },
          ],
        })
      );

      if (option && typeof option === "object") {
        myChart.setOption(option);
      }

      window.addEventListener("resize", myChart.resize);
    </script>
  </body>
</html>
